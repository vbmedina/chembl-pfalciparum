<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ChEMBL: Plasmodium falciparum Dashboard</title>

  <!-- Bootstrap for responsive layout & cards -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    /* 1) Use Arial everywhere */
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
    }
    /* 2) Make each 3D plot 60% of viewport height */
    .plot-3d {
      height: 60vh;
      width: 100%;
    }
  </style>
</head>

<body>
  <!-- ================= SUMMARY ================= -->
  <div class="container mb-5">
    <h1 class="display-6 text-center mb-3">
      ChEMBL: Plasmodium falciparum (ID: CHEMBL364)
    </h1>
    <p class="text-center text-muted mb-1">05/02/25</p>
    <p>
      Most current data on Malaria (Plasmodium falciparum) can be found at
      <a href="https://www.ebi.ac.uk/chembl/explore/target/CHEMBL364" target="_blank">
        ChEMBL364
      </a>.
    </p>

    <h5>Bioactivity Scores include:</h5>
    <ul>
      <li>IC₅₀: 5.93% of available data → 57,490 hits</li>
      <li>EC₅₀: 2.57% of available data → 24,948 hits</li>
      <li>XC₅₀: 1.40% of available data → 13,551 hits</li>
      <li>IC₉₀: 0.16% of available data → 1,558 hits</li>
    </ul>
    <p>
      Final number of data-points after pre-processing: <strong>40,324</strong><br>
      19,230 unique molecules and 287 unique strains
    </p>

    <h5>What is IC₅₀?</h5>
    <p>
      IC₅₀ is the concentration of a drug required to inhibit 50% of a target’s 
      biological activity, measured in molarity (µM or nM). It’s derived from 
      the midpoint of a sigmoidal dose-response curve.
    </p>

    <h5>Why IC₅₀ matters</h5>
    <ul>
      <li>Standard pharmacology metric—widely reported in ChEMBL</li>
      <li>Allows cross-study comparability</li>
      <li>More abundant than rarer endpoints (e.g. IC₉₀), giving you more data</li>
      <li>Produces stable, consistent signals for training deep-learning models</li>
    </ul>

    <h5>Preprocessing breakdown:</h5>
    <table class="table table-sm">
      <thead>
        <tr><th>Stage</th><th>Rows removed</th></tr>
      </thead>
      <tbody>
        <tr><td>Strains</td><td>5,034</td></tr>
        <tr><td>IC₅₀ Scores missing</td><td>10,449</td></tr>
        <tr><td>Sexual Stage Specific</td><td>1,608</td></tr>
        <tr><td>SMILES invalid</td><td>75</td></tr>
      </tbody>
    </table>
  </div>

  <!-- =============== PIE CHART ROW =============== -->
  <div class="container mb-5">
    <div class="card shadow-sm">
      <div class="card-header bg-info text-white">
        Associated Bioactivities
      </div>
      <div class="card-body">
        <div id="pieChart" style="height:400px;"></div>
      </div>
    </div>
  </div>

  <!-- ======== UMAP vs t-SNE 3D Row ======== -->
  <div class="container">
    <div class="row gy-4">
      <div class="col-12 col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-primary text-white">UMAP</div>
          <div id="umap" class="card-body p-0 plot-3d"></div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-success text-white">t-SNE</div>
          <div id="tsne" class="card-body p-0 plot-3d"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ SCRIPTS ============ -->
  <script>
    // --- PIE CHART DATA (hard-code or fetch from a JSON endpoint) ---
    const pieLabels = [
      'IC₅₀','EC₅₀','XC₅₀','IC₉₀','Other'
    ];
    const pieValues = [57490,24948,13551,1558, /* rest = total–sum */ 147592 - (57490+24948+13551+1558)];

    Plotly.newPlot('pieChart', [{
      type: 'pie',
      labels: pieLabels,
      values: pieValues,
      textinfo: 'label+percent',
      insidetextorientation: 'radial'
    }], {
      margin: { t:0, b:0, l:0, r:0 },
      template: 'plotly_white'
    }, {
      responsive: true,
      displayModeBar: false
    });

    // --- COMMON 3D CONFIG & LAYOUT ---
    const COLORS = { High: '#FDE725', Moderate: '#7AD151', Low: '#22A884' };
    const LAYOUT3D = {
      margin: { t:40, b:20, l:0, r:0 },
      scene: { xaxis:{}, yaxis:{}, zaxis:{} },
      legend: {
        x:0.02, y:0.98,
        bgcolor:'rgba(255,255,255,0.8)',
        bordercolor:'#ccc', borderwidth:1
      },
      template:'plotly_white'
    };
    const CONFIG3D = {
      responsive: true,
      displayModeBar: 'hover',   // only show on hover
      modeBarButtonsToAdd: ['resetCameraDefault','zoom3d','pan3d'],
      displaylogo: false
    };

    function plot3D(url, divId) {
      fetch(url)
        .then(r => r.json())
        .then(data => {
          // group by potency bucket
          const groups = {};
          data.forEach(pt => {
            const b = pt.Potency_Bucket || 'Unknown';
            (groups[b] = groups[b]||[]).push(pt);
          });

          // one trace per bucket
          const traces = Object.entries(groups).map(([bucket, pts]) => ({
            x: pts.map(p=>p.x),
            y: pts.map(p=>p.y),
            z: pts.map(p=>p.z),
            name: bucket,
            mode: 'markers',
            type: 'scatter3d',
            marker: {
              size: 3,
              color: COLORS[bucket]||'#999',
              opacity: 0.8
            }
          }));

          Plotly.newPlot(divId, traces, LAYOUT3D, CONFIG3D);
        })
        .catch(e => console.error(e));
    }

    // draw them
    plot3D('umap_embedding.json','umap');
    plot3D('tsne_embedding.json','tsne');
  </script>
</body>
</html>

